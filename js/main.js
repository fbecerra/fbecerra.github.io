const projects = [
    {
        "dir": "projects/inflation-per-age/",
        "img_format": "jpg",
        "img_alt": "Interactive visualization of a Voronoi treemap to explore how inflation affects people of different ages.",
        "tags": [
            "d3.js",
            "interactive",
            "dataviz"
        ],
        "title": "Inflation for Americans at each age",
        "description": "How does inflation affect Americans at different ages?",
        "details_title": "Inflation for Americans at each age",
        "details_client": "USA Facts",
        "details_date": "July 2022",
        "details_team": "Amanda Cox, Amber Thomas, and Ryan Shackleton",
        "details": "According to the Bureau of Labor Statistics, consumer prices rose 9.1% from June 2021 to June 2022, the highest rate since 1981. But households in different age groups spend money differently, so inflation rates vary by age, too. This interactive visualization shows average spending for households at each age, in more than 200 categories that make up the inflation index.",
        "repo": "",
        "link": "https://usafacts.org/projects/cpi/inflation-parts",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/beyond-education-outcomes/",
        "img_format": "jpg",
        "img_alt": "Interactive visualization to explore gaps in educational resources for students from different racial and ethnic backgrounds.",
        "tags": [
            "d3.js",
            "interactive",
            "dataviz"
        ],
        "title": "Beyond education outcomes",
        "description": "How equitably distributed are educational resources?",
        "details_title": "Beyond education outcomes",
        "details_client": "The Urban Institute",
        "details_date": "January 2022",
        "details_team": "Allison Feldman and Wesley Jenkins",
        "details": "Student success is typically measured through outcomes, such as test scores and graduation rates. But those measures often overlook the inputs—including access to experienced teachers, counselors, and other resources—that helped create those outcomes. This tool displays the share of students from different racial and ethnic backgrounds who attend schools that have access to experienced teachers, Advanced Placement (AP) classes, and school counselors.",
        "repo": "https://github.com/UrbanInstitute/education-equity-tool",
        "link": "https://apps.urban.org/features/education-equity-tool/",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/giving-dashboard/",
        "img_format": "jpg",
        "img_alt": "Dashboard that shows trends for donations in the United States.",
        "tags": [
            "d3.js",
            "dataviz"
        ],
        "title": "Giving dashboard",
        "description": "A snapshot of the many ways Americans give",
        "details_title": "Giving dashboard",
        "details_client": "The Urban Institute",
        "details_date": "April 2022",
        "details_team": "JoElla Carman and Wesley Jenkins",
        "details": "Colleting information from different sources of data, this dashboard gives an overview of the different ways Americans give, including donations to tax-exempt nonprofits, crowdfunding, impact investing, donor-advised funds, and digital giving, among others. The figures in this dashboard represent indicators that illuminate the dominant trends shaping the contemporary giving landscape in the United States.",
        "repo": "https://github.com/UrbanInstitute/giving-dashboard",
        "link": "https://apps.urban.org/features/giving-dashboard/",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/leaky-pipeline-advanced-placement-testing/",
        "img_format": "png",
        "img_alt": "Interactive visualization to explore gaps between AP classes enrollment and AP test taking in Florida.",
        "tags": [
            "d3.js",
            "interactive",
            "dataviz"
        ],
        "title": "The leaky pipeline of advanced placement testing",
        "description": "The gap between AP class enrollment and AP test taking",
        "details_title": "The leaky pipeline of advanced placement testing",
        "details_client": "The Urban Institute",
        "details_date": "February 2022",
        "details_team": "Christina Baird",
        "details": "Through funding for students, Florida ranks first in the nation for Advanced Plamente (AP) test participariont rate. But even as Florida has worked to ensure equal acces to advanced courses and the benefits that come with them, racial disparities remain. In this interactive map we show the gap betwen AP class enrollment and AP test taking for each racial or ethnic group and each district in Florida.",
        "repo": "",
        "link": "https://www.urban.org/policy-centers/center-education-data-and-policy/projects/leaky-pipeline-advanced-placement-testing",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/give-people-paid-holidays/",
        "img_format": "jpg",
        "img_alt": "Interactive essay showing that holidays have been more efficient than lockdowns in keeping people at home.",
        "tags": [
            "d3.js",
            "interactive",
            "essay"
        ],
        "title": "Give people paid holidays",
        "description": "What is more efficient at keeping people at home?",
        "details_title": "Give people paid holidays",
        "details_client": "Personal project",
        "details_date": "May 2021",
        "details_team": "",
        "details": "Since the beginning of the pandemic governments have been enforcing lockdowns to keep people at home and control the spread of the virus. For most families, it is hard to stop working without appropiate economic incentives, and, eventually, are forced to go back to their workplaces as soon as the lockdown is over. The key to finding a way of forcing people staying home while getting paid might be more familiar than what you think and it is (un)surprisingly effective: holidays. By analyzing Google's COVID mobility reports, I explored the patterns of time spent at work versus time spent in residential areas and found that holidays are the events that are most efficient at keeping people at home.",
        "repo": "https://github.com/fbecerra/covid-mobility",
        "link": "https://www.fernandobecerra.com/covid-mobility/",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/covid19-toll-chile/",
        "img_format": "jpg",
        "img_alt": "Interactive visualizaiton to explore COVID-19 cases and deaths in Chile.",
        "tags": [
            "d3.js",
            "interactive",
            "dataviz"
        ],
        "title": "The COVID-19 toll in Chile",
        "description": "Visualizing Chile's COVID-19 cases and deaths",
        "details_title": "Visualizing Chile's COVID-19 cases",
        "details_client": "Personal project",
        "details_date": "June 2020",
        "details_team": "",
        "details": "As COVID-19 cases began to steeply increase, graphs became an important way of communicating the impact that the pandemic was having globally. Media outlets, non-profits, government agencies, and other institutions started collecting the number of cases and deaths  in different regions of the world. Many interactive visualizations became very popular overnight as a way to keep track of all that data without it becoming too overwhelming. That motivated me to create one of such visualizations for COVID-19 statistics in Chile, which would focus on making the data at the region and commune levels available for everyone to explore.",
        "repo": "https://github.com/fbecerra/covid19chile",
        "link": "https://www.fernandobecerra.com/covid19chile/",
        "img_dir": "img/overview.jpg"
    },
    {
        "dir": "projects/degrees-of-value/",
        "img_format": "jpg",
        "img_alt": "Interactive visualization to explore how different metrics affect the performance of educational institutions in a high-quality accountability system.",
        "tags": [
            "d3.js",
            "interactive",
            "dataviz"
        ],
        "title": "Degrees of value",
        "description": "How policymakers can design a high-quality college accountability system",
        "details_title": "Degrees of value",
        "details_client": "The Urban Institute",
        "details_date": "June 2022",
        "details_team": "Christina Baird and Wesley Jenkins",
        "details": "A high-quality accountability system for colleges require more than just student loan default rates to hold institutions accountable for the quality of their programs. Here, we explore how additional metrics such as how many students complete their degrees and certificates, how much students earn after leaving school, and how much students still owe five years into loan repayment affect how these institutions perform.",
        "repo": "https://github.com/UrbanInstitute/threshold-accountability-metrics",
        "link": "https://www.urban.org/features/degrees-value",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/single-cell-analysis-sequencing/",
        "img_format": "jpg",
        "img_alt": "Interactive visualization to explore the Gen Expression Omnibus dataset and the relation between those genes.",
        "tags": [
            "d3.js",
            "interactive"
        ],
        "title": "Single cell analysis and sequencing",
        "description": "Navigating through the Gen Expression Omnibus dataset",
        "details_title": "Exploring single cell analysis and sequencing",
        "details_client": "Needle Genomics",
        "details_date": "November 2021",
        "details_team": "Brian Fox",
        "details": "Visualizing scientific data is always a challenge because of the many variables and dimensions involved, but making it available in an easy-to-explore way should be a priority for scientists. One especially difficult dataset to represent graphically is gene expression data due to the huge quantity of information available for each cell. In this project, I developed a gene expression web application that visualizes single cell RNA-seq data using pre-calculated t-SNE coordinates for each cell. This tool allows experts to navigate through the overwhelming Gen Expression Omnibus dataset and focus on the most relevant genes and their properties.",
        "repo": "",
        "link": "",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/paper-citations-authors-collaborations/",
        "img_format": "jpg",
        "img_alt": "Interactive network visualization showing citations between papers and collaborations between authors.",
        "tags": [
            "d3.js",
            "interactive"
        ],
        "title": "Paper citations, authors collaborations",
        "description": "Visualizing collaborative networks in academia",
        "details_title": "Collaboration networks in Academia",
        "details_client": "Research Rabbit",
        "details_date": "August 2021",
        "details_team": "Michael Ma",
        "details": "For researchers in academia, keeping track of the overwhelming number of publications, citations, and references has always been an issue. Tools like Mendeley or Papers have gained popularity as a way of keeping everything as ordered as possible, focusing on building an easy-to-access reference library. Research Rabbit goes a step further and helps you discover relevant articles for your research providing a map of the relation between papers and authors. To show and explore how these articles are connected, I built a interactive network visualization that allows the user to select a group of articles and discover papers that are cited or referenced by them.",
        "repo": "",
        "link": "https://researchrabbitapp.com/",
        "img_dir": "img/overview.jpg"
    },
    {
        "dir": "projects/hattori-plots/",
        "img_format": "jpg",
        "img_alt": "Static plots showing relationship between fat and fat-free mass for a cohort of Chilean kids.",
        "tags": [
            "python",
            "data science",
            "dataviz"
        ],
        "title": "Hattori plots",
        "description": "Studying fatty liver desease in Chilean populations",
        "details_title": "Studying Non-Alcoholic Fatty Liver Desease in Chilean populations",
        "details_client": "Pontifical Catholic University of Chile",
        "details_date": "October 2021",
        "details_team": "Mariana Faune, Thelma Cantillo, Gigiola Alberti, and Juan Cristóbal Gana",
        "details": "Obesity is one of the most common deseases in the Chilean young population. Because of this, it is crucial to study its risks and relationships to fat content in other parts of the body such as liver and pancreas. For that, we analyzed data from a cohort of people that were followed annually since their birth until their 18th birthday. We studied the evolution of their fat mass, fat-free mass, height, and BMI, and related those quantities to the risk of presenting Non-Alcoholic Fatty Liver Desease and Non-Alcoholic Fatty Pancreas Desease.",
        "repo": "",
        "link": "",
        "img_dir": "img/thumbnail.png"
    },
    {
        "dir": "projects/joy-of-parsing/",
        "img_format": "jpg",
        "img_alt": "Interactive visualization to explore Bob Ross paintings and how they cluster together based on the transcripts of the show The Joy of Painting.",
        "tags": [
            "d3.js",
            "python",
            "data science"
        ],
        "title": "The joy of parsing",
        "description": "Visualizing Bob Ross's paintings",
        "details_title": "The Joy of Parsing",
        "details_client": "Fathom Information Design",
        "details_date": "May 2019",
        "details_team": "Paul Cronan and Ben Fry",
        "details": "The first time I watched and episode of <i>The Joy of Painting</i> I was mesmerized by the paintings, the phrases, and Bob Ross. A few months after, we were developing tools to explore and understand large archives at Fathom. While my colleagues were analyzing serious document sets, I decided to apply those techniques to the transcripts of each episode of <i>The Joy of Painting</i>. What started as a simple analysis of the frequency of iconic phrases such as <i>Let's draw some happy little trees</i> and <i>Just beat the devil out of it</i> quickly evolved into an interactive visualization to explore his paintings.",
        "repo": "",
        "link": "https://fathom.info/bobross",
        "img_dir": "img/overview.jpg"
    },
    {
        "dir": "projects/formation-first-black-holes/",
        "img_format": "jpg",
        "img_alt": "Scientific research studying the formation of supermassive black hole seeds in the early Universe.",
        "tags": [
            "python",
            "astronomy",
            "research"
        ],
        "title": "Formation of the first black holes",
        "description": "Simulating the creation of early black holes in the Universe",
        "details_title": "Formation of the first supermassive black holes in the Universe",
        "details_client": "Graduate Research",
        "details_date": "May 2018",
        "details_team": "Volker Bromm and Lars Hernquist",
        "details": "Black holes have a reputation of being mysterious objects where time and space lose their meaning, and as such they have always attracted our curiosity. So far, astronomers have a pretty good idea of how present-day black holes formed, but the picture is not that clear for the <i>first</i> black holes - those formed in the early days of the Universe. These objects are particularly hard to study since we can't observe them with our current telescopes. In order to study their formation, I ran numerical simulations of the conditions in the early Universe and followed their evolution until they became massive enough to be considered a black hole.",
        "repo": "https://github.com/fbecerra/pacha",
        "link": "https://fernandobecerra.com/astro",
        "img_dir": ""
    },
    {
        "dir": "projects/la-county-covid19-watch/",
        "img_format": "png",
        "img_alt": "Interactive visualizaiton to show the evolution of COVID-19 cases for the LA County Department of Public Health.",
        "tags": [
            "d3.js",
            "data visualization"
        ],
        "title": "LA County's COVID-19 Watch",
        "description": "Tracking LA Country's COVID-19 statistics",
        "details_title": "Tracking LA County's COVID-19 statistics",
        "details_client": "LA County Department of Public Health",
        "details_date": "October 2020",
        "details_team": "Anjali Tripathi",
        "details": "As the COVID-19 pandemic developed, more and more data became available to inform researchers, the media, and the general population. In order to inform their citizens of the current state of the pandemic, the County of Los Angeles Health Department published in their website a series of statistics regarding testing, symptoms, and deaths. Some of these graphics were generated as an image and needed to be updated manually every day, wasting time and resources. In order to optimize this process, I implemented a d3 plot that self-updates once the dataset is updated and adds interactivity to give more details to the user.",
        "repo": "",
        "link": "http://publichealth.lacounty.gov/acd/ncorona2019/covidwatch/",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/astrollytelling/",
        "img_format": "jpg",
        "img_alt": "Project to teach astronomy concepts through interactive visualizations and essays.",
        "tags": [
            "d3.js",
            "interactive",
            "storytelling"
        ],
        "title": "Astrollytelling",
        "description": "Teaching astronomy through interactive visualizations",
        "details_title": "Teaching astronomy through interactive visualizations",
        "details_client": "Personal project",
        "details_date": "May 2018",
        "details_team": "Jieun Choi",
        "details": "Scientific research is usually made available to the community through publications in renowned journals or presentations at conferences. The audience of these media is often the scientific community, which is used to a very technical language and static graphical representations and hence forces the authors to preserve this format. I wanted to communicate astronomy research in a different format, having the general audience in mind, avoiding jargon and adding interactivity. Since my field of expertise in grad school was astronomy, I decided to create Astrollytelling and use interactive visualizations to explain astronomy concepts.",
        "repo": "https://github.com/astrollytelling",
        "link": "https://astrollytelling.github.io",
        "img_dir": "img/overview.jpg"
    },
    {
        "dir": "projects/plebiscite-new-constitution/",
        "img_format": "jpg",
        "img_alt": "Interactive visualization showing the timeline of the bills introduced to change the Chilean constitution.",
        "tags": [
            "d3.js",
            "interactive"
        ],
        "title": "Changing the constitution",
        "description": "Exploring bills introduced to reform the Chilean Constitution",
        "details_title": "Reforming Chile's Constitution",
        "details_client": "Personal project",
        "details_date": "October 2020",
        "details_team": "",
        "details": "In 2020 Chile held a national plebiscite to decide if its citizens wanted to have a new Constitution. The previous one had been written during Pinochet's dictatorship in 1980 and had been modified <a href='https://pbs.twimg.com/media/EkTB4uXWkAIIvuj.jpg' target='_blank'>more than 250 times</a> since its inception.  Right-wing parties used these modifications to campaing against a new constitution under the motto <i>Reject to reform</i> (reject the new constitution, to reform the previous one) and that rethoric was soon picked up by media outlets. But these facts were lacking context: how many times Chilean representatives have tried to modify the constitution? Is 257 times too many or too few? To answer these questions, I analyzed the bills introduce to Chile's Chamber of Deputies to modify the Constitution since 1980 and track them until their approval or rejection.",
        "repo": "https://github.com/fbecerra/reformas",
        "link": "https://www.fernandobecerra.com/reformas/",
        "img_dir": "img/overview.png"
    },
    {
        "dir": "projects/who-should-pay/",
        "img_format": "jpg",
        "img_alt": "Data-driven visualization of how policymakers can change income-driven repayment plan designs to creat more affordable payments.",
        "tags": [
            "d3.js",
            "dataviz"
        ],
        "title": "Who should pay?",
        "description": "Designing a more equitable income-driven repayment plan",
        "details_title": "Who should pay?",
        "details_client": "The Urban Institute",
        "details_date": "June 2022",
        "details_team": "Christina Baird and Wesley Jenkins",
        "details": "In a nation where 43 million people have student loan debt, an income-driven repayment (IDR) plan can offer a more affordable option for paying off loan balances. This visualization illustrates how policymakers can change IDR plan designs to create more affordable payments, more equitable repayment timelines, and more manageable debt balances, all while ensuring the system’s continued viability.",
        "repo": "",
        "link": "https://www.urban.org/features/who-should-pay",
        "img_dir": "img/overview.png"
    },
];

const logos = [
    {
        "src": "projects/inflation-per-age/img/logo.jpg",
        "alt": "USAFacts logo"
    },
    {
        "src": "projects/beyond-education-outcomes/img/logo.png",
        "alt": "Urban Institute logo"
    },
    {
        "src": "projects/propublica/img/logo.png",
        "alt": "ProPublica logo"
    },
    {
        "src": "projects/planet/img/logo.png",
        "alt": "Planet Labs logo"
    },
    {
        "src": "projects/hattori-plots/img/logo.png",
        "alt": "Pontifical Catholic University of Chile logo"
    },
    {
        "src": "projects/emteq/img/logo.png",
        "alt": "Emteq Labs logo"
    },
    {
        "src": "projects/la-county-covid19-watch/img/logo.png",
        "alt": "LA County Department of Public Health logo"
    },
    {
        "src": "projects/atomics/img/logo.png",
        "alt": "Copenhagen Atomics logo"
    },
    {
        "src": "projects/paper-citations-authors-collaborations/img/logo.png",
        "alt": "Research Rabbit App logo"
    },
    {
        "src": "projects/zero1/img/logo.png",
        "alt": "Zero-1 logo"
    },
    {
        "src": "projects/single-cell-analysis-sequencing/img/logo.png",
        "alt": "Needle Genomics logo"
    }
];

let state = {
    projectIdx: null,
    showingDetails: false
}

const showDetails = function() {
    let project = projects[state.projectIdx];
    
    d3.select("#project-title")
        .html(project.details_title);

    d3.select("#project-description")
        .html(project.details);

    d3.select("#project-client")
        .html(project.details_client + ", " + project.details_date);

    d3.select("#project-team")
        .html(project.details_team !== "" ? "With " + project.details_team : "");

    d3.select("#project-repo")
        .attr("href", project.repo);
    
    d3.select("#project-link")
        .attr("href", project.link);

    d3.select("#project-image")
        .attr("src", project.dir + project.img_dir);

    d3.select(".details")
        .style("display", "block");
};

const hideDetails = function() {
    state.showingDetails = false;

    d3.select(".details")
        .style("display", "none");
}

const nextIdx = function() {
    state.projectIdx = state.projectIdx + 1 > projects.length - 1 ? 0 : state.projectIdx + 1;
}

const prevIdx = function() {
    state.projectIdx = state.projectIdx - 1 < 0 ? projects.length - 1 : state.projectIdx - 1;
}

d3.select("#close")
    .on("click", hideDetails);

d3.select("#right")
    .on("click", () => {
        nextIdx();
        showDetails();
    });

d3.select("#left")
    .on("click", () => {
        prevIdx();
        showDetails();
    });

const wrapper = d3.select("#project-gallery");

const itemCol = wrapper.selectAll(".grid-item")
    .data(projects)
    .join("div")
        .attr("class", "col-lg-4 col-md-4 grid-item mb-4");

const item = itemCol.selectAll(".listing-item")
    .data(d => [d])
    .join("div")
        .attr("class", "listing-item")

const divImage = item.append("div")
    .attr("class", "position-relative");

const linkImage = divImage.append("a")
    .attr("class", "reset-anchor d-block listing-img-holder")
    .on("click", (_, d) => {
        state.projectIdx = projects.indexOf(d);
        state.showingDetails = true;
        showDetails();
    });

linkImage.append("img")
    .attr("class", "img-fluid")
    .attr("src", d => d.dir + "/img/thumbnail." + d.img_format)
    .attr("alt", d => d.img_alt);

const linkP = linkImage.append("p")
    .attr("class", "mb-0 text-primary small d-flex align-items-center listing-btn");

linkP.append("span")
    .html("Read more");
linkP.append("svg")
    .attr("class", "svg-icon text-primary svg-icon-sm ml-2")
    .append("use")
    .attr("xlink:href", "#arrow-right-1");

const divTags = item.append("div")
    .attr("class", "position-relative border-left mt-2 mb-4");

const listTags = divTags.append("ul")
    .attr("class", "list-inline listing-tags m-0 pb-1")

listTags.selectAll("li")
    .data(d => d.tags)
    .join("li")
        .attr("class", "list-inline-item reset-anchor font-weight-normal text-small")
        .html(d => d);

// const divTitle = item.append("div")
//     .attr("class", "pt-0 pb-2");

divTags.append("a")
    .attr("class", "reset-anchor")
    .append("h1")
    .attr("class", "h5 listing-item-heading")
    .html(d => d.title)
    .on("click", (_, d) => {
        state.projectIdx = projects.indexOf(d);
        state.showingDetails = true;
        showDetails();
    });

divTags.append("h2")
    .attr("class", "text-small mb-0 listing-item-description")
    .html(d => d.description);

const logosDiv = d3.select("#client-logos");

const logoItem = logosDiv.selectAll(".grid-item")
    .data(logos)
    .join("div")
        .attr("class", "col-6 col-lg-3 col-md-3 grid-item mb-4");

logoItem.append("div")
    .attr("class", "listing-item")
    .append("div")
    .attr("class", "position-relative")
    .append("img")
        .attr("class", "img-fluid img-logo")
        .attr("src", d => d.src)
        .attr("alt", d => d.alt);

document.onkeydown = function(e) {
    if (state.showingDetails) {
        if (e.key == "Escape") {
            hideDetails();
        } else if (e.key == 'ArrowRight') {
            nextIdx();
            showDetails();
        } else if (e.key == 'ArrowLeft') {
            prevIdx();
            showDetails();
        }
    }
};
          